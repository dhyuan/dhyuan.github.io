<!DOCTYPE HTML>
<html lang="zh-CN">
<head>
  <meta charset="utf-8">
  
  <title>第 8 页 | 浅流</title>
  <meta name="author" content="Dahui">
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  
  <meta property="og:site_name" content="浅流"/>

  
    <meta property="og:image" content=""/>
  

  <link rel="shortcut icon" href="/favicon.png">
  
  
<link rel="stylesheet" href="/css/style.css">

  <!--[if lt IE 9]><script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script><![endif]-->
  

<meta name="generator" content="Hexo 5.4.0"></head>


<body>
  <header id="header" class="inner"><div class="alignleft">
  <h1><a href="/">浅流</a></h1>
  <h2><a href="/"></a></h2>
</div>
<nav id="main-nav" class="alignright">
  <ul>
    
      <li><a href="/null">Home</a></li>
    
      <li><a href="/archives">Archives</a></li>
    
  </ul>
  <div class="clearfix"></div>
</nav>
<div class="clearfix"></div>
</header>
  <div id="content" class="inner">
    <div id="main-col" class="alignleft"><div id="wrapper">
  <article id="post-notes/tools/about-slf4j" class="h-entry post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time class="dt-published" datetime="2019-10-24T07:55:38.000Z"><a href="/2019/10/24/notes/tools/about-slf4j/">2019-10-24</a></time>
      
      
  
    <h1 class="title"><a href="/2019/10/24/notes/tools/about-slf4j/">About SLF4J</a></h1>
  

    </header>
    <div class="e-content entry" itemprop="articleBody">
      
        <h3 id="SLF4J-是什么？"><a href="#SLF4J-是什么？" class="headerlink" title="SLF4J 是什么？"></a>SLF4J 是什么？</h3><p>Java 的世界里有很多优秀的 log 库，比如 logback，log4j2。SLF4J（Simple Logging Facade）作为一个日志框架的抽象层，以 Facade 模式帮助我们“无缝”地选择、切换这些 log 库。</p>
<h3 id="如何使用-SLF4J？"><a href="#如何使用-SLF4J？" class="headerlink" title="如何使用 SLF4J？"></a>如何使用 SLF4J？</h3><p>在项目中要使用 SLF4J 需要做的就是引入 slf4j-api-2.0.7.jar，再根据你选择的底层 log 框架选择对应的 provider。比如，<br>如果底层使用 log4j2，就要导入 log4j-slf4j-impl（provider/bridge）、log4j-api.jar（log4j 接口）、log4j-core（log4j 实现）。<br>如果底层使用 logback，就要导入”ch.qos.logback:logback-classic”，这个会自动导入 slf4j-api-2.0.7.jar（provider/bridge）、logback-core-1.3.6.jar（logback 实现）。</p>
<p>SpringBoot 底层默认支持 logbak，如果使用 log4j2 则需要显示的 exclude logback。</p>
<pre><code>&lt;dependencies&gt;
  &lt;dependency&gt;
      &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
      &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;
      &lt;exclusions&gt;
        &lt;exclusion&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-logging&lt;/artifactId&gt;
        &lt;/exclusion&gt;
      &lt;/exclusions&gt;
  &lt;/dependency&gt;
  &lt;dependency&gt;
      &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
      &lt;artifactId&gt;spring-boot-starter-log4j2&lt;/artifactId&gt;
  &lt;/dependency&gt;
&lt;dpendencies&gt;
</code></pre>
<h3 id="关于-SLF4J-的-MDC"><a href="#关于-SLF4J-的-MDC" class="headerlink" title="关于 SLF4J 的 MDC"></a>关于 SLF4J 的 MDC</h3><p>SLF4J, 在底层库支持 MDC(Mapped Diagnostic Context)的情况下也是支持 MDC 的。<code>MDC data can also be highly helpful in filtering messages or triggering certain actions</code>, 目前也就 log4j2, logback 支持 MDC。在当前微服务流行的情况下让各个微服务的日志格式遵循同一格式是困难的，而且 MDC 的跨服务传递也是不现实的，这个特性在实际工程中用的比较少。</p>
<h3 id="关于-log4j2-自己的-log。"><a href="#关于-log4j2-自己的-log。" class="headerlink" title="关于 log4j2 自己的 log。"></a>关于 log4j2 自己的 log。</h3><ol>
<li>如果我们希望看到 log4j2 自己的 log，可以设置-Dlog4j2.debug=true，让它自己的 log 显示在 console。</li>
<li><a target="_blank" rel="noopener" href="https://logging.apache.org/log4j/2.x/manual/configuration.html#CompositeConfiguration">Composite Configuration</a>, 因为可以通过 log4j2.configurationFile 设置多个逗号分隔的配置文件，log4j 有一套自己的逻辑对多个配置文件进行 merge。所以除非项目中有特定的需求，显示的通过 log4j2.configurationFile 显示的指定配置文件可以减少不必要的困惑。</li>
</ol>
<br/>
<br/>

<hr>
<p><em>References</em>:<br>[1]: <a target="_blank" rel="noopener" href="https://www.slf4j.org/manual.html">https://www.slf4j.org/manual.html</a><br>[2]: <a target="_blank" rel="noopener" href="https://logging.apache.org/log4j/2.x/manual/configuration.html#CompositeConfiguration">https://logging.apache.org/log4j/2.x/manual/configuration.html#CompositeConfiguration</a><br>[3]: <a target="_blank" rel="noopener" href="https://howtodoinjava.com/logback/setting-up-slf4j/">https://howtodoinjava.com/logback/setting-up-slf4j/</a></p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article id="post-mongo/setupMongoForLocalDevEnv" class="h-entry post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time class="dt-published" datetime="2019-09-19T07:55:38.000Z"><a href="/2019/09/19/mongo/setupMongoForLocalDevEnv/">2019-09-19</a></time>
      
      
  
    <h1 class="title"><a href="/2019/09/19/mongo/setupMongoForLocalDevEnv/">为本地Mac开发环境设置mongo服务</a></h1>
  

    </header>
    <div class="e-content entry" itemprop="articleBody">
      
        <h3 id="1）安装"><a href="#1）安装" class="headerlink" title="1）安装"></a>1）安装</h3><p>Mac 上通过 brew 安装 Mongo 参考：<a target="_blank" rel="noopener" href="https://docs.mongodb.com/manual/tutorial/install-mongodb-on-os-x/#std-label-install">https://docs.mongodb.com/manual/tutorial/install-mongodb-on-os-x/#std-label-install</a></p>
<pre><code>brew tap mongodb/brew
brew install mongodb-community@5.0

brew services start/restart/stop mongodb-community@5.0
brew services list
</code></pre>
<p>通过 brew 安装后，MongoDB 的配置文件在 /usr/local/etc/mongod.conf，可根据实际情况设置端口、认证、复制集等。</p>
<pre><code>net:
  port: 27117
  bindIp: 0.0.0.0
replication:
  replSetName: rs0
</code></pre>
<h3 id="2-设置密码登录"><a href="#2-设置密码登录" class="headerlink" title="2) 设置密码登录"></a>2) 设置密码登录</h3><p>创建超级用户、普通用户：<br>mongosh</p>
<pre><code>use admin
db.createUser(
  &#123;
    user: &quot;root&quot;,
    pwd: &quot;password&quot;,
    roles: [
      &#123; role: &quot;root&quot;, db: &quot;admin&quot; &#125;
    ]
  &#125;
)

// 创建用户test，对数据库testDB1、testDB2读写的权限，其authorizaiton的DB是testDB1。
use testDB1
db.createUser(
  &#123;
    user: &quot;testuser&quot;,
    pwd: &quot;123&quot;,
    roles: [
      &#123; role: &quot;readWrite&quot;, db: &quot;testDB&quot; &#125;,
      &#123; role: &quot;readWrite&quot;, db: &quot;testDB2&quot; &#125;
    ]
  &#125;
)
</code></pre>
<p>给 root 用户设置 clusterManager 角色，这样才可以使用 rs.initiate()、rs.conf()与复制集相关的命令。</p>
<pre><code>use admin
db.grantRolesToUser(
  &quot;root&quot;,
  [ &quot;clusterManager&quot; ]
)
</code></pre>
<p>这个 dbAdminAnyDatabase 角色似乎很‘方便’。</p>
<pre><code>db.grantRolesToUser(&quot;yourUser&quot;, [&#123;&quot;role&quot;: &quot;dbAdminAnyDatabase&quot;, &quot;db&quot;: &quot;admin&quot;&#125;])
</code></pre>
<h3 id="3）设置复制集。"><a href="#3）设置复制集。" class="headerlink" title="3）设置复制集。"></a>3）设置复制集。</h3><p>复制集需要安全通行。首先生成 mongodb 私钥<br>Reference：<a target="_blank" rel="noopener" href="https://docs.mongodb.com/manual/tutorial/enforce-keyfile-access-control-in-existing-replica-set/">https://docs.mongodb.com/manual/tutorial/enforce-keyfile-access-control-in-existing-replica-set/</a></p>
<pre><code>openssl rand -base64 756 &gt; KEY_PATH/mongo_server.key
</code></pre>
<p>修改配置设置 keyFile：</p>
<pre><code>security:
  keyFile: KEY_PATH/mongo_server.key
  authorization: enabled
</code></pre>
<p>强制设置本地节点复制集名称。</p>
<pre><code>replication:
  replSetName: rs0
</code></pre>
<p>重启 mongo</p>
<pre><code>brew services restart mongodb-community
</code></pre>
<p>进入 mongosh，执行 rs.initiate()初始化数据集：</p>
<pre><code>rs.initiate()
rs.conf()
</code></pre>
<h3 id="4）强制设置-master-复制集。"><a href="#4）强制设置-master-复制集。" class="headerlink" title="4）强制设置 master 复制集。"></a>4）强制设置 master 复制集。</h3><p>遇到的问题及解决：开始在端口为 27017 的情况下按照 <a target="_blank" rel="noopener" href="https://mongoing.com/docs/tutorial/convert-standalone-to-replica-set.html">https://mongoing.com/docs/tutorial/convert-standalone-to-replica-set.html</a> 介绍的方式把单节点的 mongo 服务转变为单复制集的方式运行。</p>
<p>接着又更改了 mongo 服务的端口为 27117，这样之前的复制集节点就不对了。<br>先加上当前 27117 端口的 mongo 服务作为一个复制集。</p>
<pre><code>rs.add(&quot;127.0.0.1:27117&quot;)
</code></pre>
<p>查看复制集配置</p>
<pre><code>rs0 [direct: primary] test&gt; cfg = rs.conf()
&#123;
  _id: &#39;rs0&#39;,
  version: 4,
  term: 30,
  members: [
    &#123;
      _id: 0,
      host: &#39;127.0.0.1:27017&#39;,
      arbiterOnly: false,
      buildIndexes: true,
      hidden: false,
      priority: 1,
      tags: &#123;&#125;,
      secondaryDelaySecs: Long(&quot;0&quot;),
      votes: 1
    &#125;,
    &#123;
      _id: 1,
      host: &#39;127.0.0.1:27117&#39;,
      arbiterOnly: false,
      buildIndexes: true,
      hidden: false,
      priority: 1,
      tags: &#123;&#125;,
      secondaryDelaySecs: Long(&quot;0&quot;),
      votes: 1
    &#125;
  ],
  protocolVersion: Long(&quot;1&quot;),
  writeConcernMajorityJournalDefault: true,
  settings: &#123;
    chainingAllowed: true,
    heartbeatIntervalMillis: 2000,
    heartbeatTimeoutSecs: 10,
    electionTimeoutMillis: 10000,
    catchUpTimeoutMillis: -1,
    catchUpTakeoverDelayMillis: 30000,
    getLastErrorModes: &#123;&#125;,
    getLastErrorDefaults: &#123; w: 1, wtimeout: 0 &#125;,
    replicaSetId: ObjectId(&quot;616d08c744db747bb7e580b8&quot;)
  &#125;
&#125;
</code></pre>
<p>删除第一节点，</p>
<pre><code>cfg.members.splice(0,1)
</code></pre>
<p>强制执行重新配置</p>
<pre><code>rs.reconfig(cfg, &#123;force : true&#125;)
</code></pre>
<h3 id="5）设置复制集。"><a href="#5）设置复制集。" class="headerlink" title="5）设置复制集。"></a>5）设置复制集。</h3><p>通过用户名密码登录</p>
<pre><code>mongosh --port 27117 -u testuser -p 123 --authenticationDatabase  test
</code></pre>
<h3 id="6）Mac-环境设置-maxfile-limit"><a href="#6）Mac-环境设置-maxfile-limit" class="headerlink" title="6）Mac 环境设置 maxfile limit"></a>6）Mac 环境设置 maxfile limit</h3><p>查看当前设置：</p>
<pre><code>launchctl limit maxfiles
</code></pre>
<p>如果 soft limit 是 256，则执行下面命令扩大。否则 mongo server 可用的线程将受限。</p>
<pre><code>sudo launchctl limit maxfiles 65536 200000
</code></pre>
<p>因为机器重启后以上更改会失效，所以还需要添加以上命令到开机脚本中。因为使用到了 sudo，可使用 visudo 修改设置免密码。</p>
<pre><code>%admin          ALL = (ALL) NOPASSWD: ALL
</code></pre>
<h3 id="7）mongo-conf"><a href="#7）mongo-conf" class="headerlink" title="7）mongo.conf"></a>7）mongo.conf</h3><p>mongo.conf 大致如此：<br>如果需要设置 MongoDB 无需认证登录的话，需要 authrozation、keyFile 这两个字段同时注释掉。·</p>
<pre><code>systemLog:
  destination: file
  path: /usr/local/var/log/mongodb/mongo.log
  logAppend: true
storage:
  dbPath: /usr/local/var/mongodb
net:
  bindIp: 127.0.0.1
  port: 27017
  maxIncomingConnections: 4096
security:
  keyFile: /YOURPATH/mongo_server.key
  authorization: enabled
replication:
  replSetName: rs0
</code></pre>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article id="post-Monoid" class="h-entry post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time class="dt-published" datetime="2018-09-12T12:43:08.000Z"><a href="/2018/09/13/Monoid/">2018-09-13</a></time>
      
      
  
    <h1 class="title"><a href="/2018/09/13/Monoid/">Monoid</a></h1>
  

    </header>
    <div class="e-content entry" itemprop="articleBody">
      
        <h3 id="Monoid"><a href="#Monoid" class="headerlink" title="Monoid"></a>Monoid</h3><h4 id="Type-signature"><a href="#Type-signature" class="headerlink" title="Type signature"></a>Type signature</h4><pre><code>public interface Monoid&lt;T&gt; : SemiGroup&lt;T&gt; &#123;
    T Empty
&#125;

class (Semigroup a) &lt;= Monoid a where
    empty :: a
</code></pre>
<h4 id="Monoid-Laws"><a href="#Monoid-Laws" class="headerlink" title="Monoid Laws:"></a>Monoid Laws:</h4><pre><code>The empty value doesn&#39;t change the meaning of a monoidal value.
a &lt;&gt; empty == a
empty &lt;&gt; a == a
</code></pre>
<h4 id="Usage-Feature-of-semigroup"><a href="#Usage-Feature-of-semigroup" class="headerlink" title="Usage/Feature of semigroup:"></a>Usage/Feature of semigroup:</h4><p>Semigroup/Monoid are domain modeling tools.</p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article id="post-Semigroup" class="h-entry post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time class="dt-published" datetime="2018-09-12T12:43:02.000Z"><a href="/2018/09/13/Semigroup/">2018-09-13</a></time>
      
      
  
    <h1 class="title"><a href="/2018/09/13/Semigroup/">Semigroup</a></h1>
  

    </header>
    <div class="e-content entry" itemprop="articleBody">
      
        <h3 id="SemiGroup-幺半群"><a href="#SemiGroup-幺半群" class="headerlink" title="SemiGroup 幺半群"></a>SemiGroup 幺半群</h3><h4 id="Type-signature"><a href="#Type-signature" class="headerlink" title="Type signature:"></a>Type signature:</h4><pre><code>// C#定义SemiGroup：
public interface SemiGroup&lt;T&gt; &#123;
    T Append(T thingToAppend);
&#125;

// 用Haskell定义：
class SemiGroup a where
    append :: a-&gt; a -&gt; a

// Haskell实现的String with append：
instance Semigroup String where
    append a b = a ++ b
</code></pre>
<p>__Law__s are additional properties that need to be satisfied beyond what’s expressed in the type signature.</p>
<h4 id="Laws-of-Semigroup"><a href="#Laws-of-Semigroup" class="headerlink" title="Laws of Semigroup:"></a>Laws of Semigroup:</h4><p><em>Append is associative.</em></p>
<pre><code>Append(Append(a, b), c) == Append(a, Append(b, c))

(a &lt;&gt; b) &lt;&gt;&gt; c == a &lt;&gt; (b &lt;&gt; c)
</code></pre>
<h4 id="Usage-Feature-of-semigroup"><a href="#Usage-Feature-of-semigroup" class="headerlink" title="Usage/Feature of semigroup:"></a>Usage/Feature of semigroup:</h4><p><strong>1）Partition friendly</strong></p>
<p><strong>2）Incremental</strong></p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article id="post-OpenSSL-create-CA-service-certificates" class="h-entry post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time class="dt-published" datetime="2018-09-10T13:24:47.000Z"><a href="/2018/09/11/OpenSSL-create-CA-service-certificates/">2018-09-11</a></time>
      
      
  
    <h1 class="title"><a href="/2018/09/11/OpenSSL-create-CA-service-certificates/">使用OpenSSL创建CA、Service证书的步骤</a></h1>
  

    </header>
    <div class="e-content entry" itemprop="articleBody">
      
        <blockquote><p>OpenSSL是SSL、TLS协议的一个实现、开源工具集。OpenSSL可用于密钥、证书管理以及相关测试。</p>
</blockquote>

<h3 id="准备目录"><a href="#准备目录" class="headerlink" title="准备目录"></a>准备目录</h3><pre><code>mkdir root-ca
cd root-ca
mkdir certs db private
chmod 700 private
touch db/index
openssl rand -hex 16 &gt; db/serial
echo 1001 &gt; db/crlnumber
</code></pre>
<h3 id="创建RootCA"><a href="#创建RootCA" class="headerlink" title="创建RootCA"></a>创建RootCA</h3><a href="/2018/09/10/OpenSSL-create-CA-service-certificates/root-ca.conf" title="root-ca.conf">root-ca.conf</a>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Create CA Private Key</span></span><br><span class="line">openssl req -new  -config root-ca.conf -out root-	ca.csr -keyout private/root-ca.key</span><br><span class="line">    </span><br><span class="line"><span class="comment"># CA self-sign</span></span><br><span class="line">openssl ca -selfsign -config root-ca.conf -<span class="keyword">in</span> root-ca.csr -out root-ca.crt -extensions ca_ext</span><br></pre></td></tr></table></figure>

<h3 id="二级CA"><a href="#二级CA" class="headerlink" title="二级CA"></a>二级CA</h3><a href="/2018/09/10/OpenSSL-create-CA-service-certificates/sub-ca.conf" title="sub-ca.conf">sub-ca.conf</a>

<pre><code># 这一步同时生产私钥和csr
openssl req -config sub-ca.conf -new -out sub-ca.csr -keyout private/sub-ca.key

# 用root ca签署sub ca
openssl ca -config root-ca.conf -in sub-ca.csr -out sub-ca.crt -extensions sub_ca_ext    
</code></pre>
<h3 id="Service-Certificate"><a href="#Service-Certificate" class="headerlink" title="Service Certificate"></a>Service Certificate</h3><pre><code>openssl genrsa -aes128 -out server.key 2048
openssl req -new -key server.key -out server.csr
openssl ca -config sub-ca.conf -in server.csr -out server.crt -extensions server_ext
</code></pre>
<p><em>Reference</em>:</p>
<p><a target="_blank" rel="noopener" href="http://www.ituring.com.cn/book/download/338e1e55-fd94-4ac3-9e21-e0bf04984b3f">《OpenSSL攻略》</a> 这篇文档详细介绍了OpenSSL的使用。</p>
<p>更多背景知识可参考：<a target="_blank" rel="noopener" href="http://www.ituring.com.cn/book/1734">《HTTPS权威指南》</a></p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article id="post-android-emulator-operations" class="h-entry post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time class="dt-published" datetime="2018-08-27T13:59:10.000Z"><a href="/2018/08/28/android-emulator-operations/">2018-08-28</a></time>
      
      
  
    <h1 class="title"><a href="/2018/08/28/android-emulator-operations/">修改Android模拟器中的文件</a></h1>
  

    </header>
    <div class="e-content entry" itemprop="articleBody">
      
        <p>本地开发机运行着server向跑在模拟器中的app提供rest api服务。</p>
<p><strong>1）模拟器中的127.0.0.1是指模拟器自己本机。</strong></p>
<p><strong>2）模拟器中使用10.0.2.2来访问开发机。</strong></p>
<p><strong>3）如果在本地tomcat启用了虚拟主机，可以修改模拟器中的/etc/hosts来指向域名。</strong></p>
<pre><code>// 列出安装的模拟器
emulator -list-avds

// 以可写模式启动模拟器
emulator -avd Your_Emulator_Name -writable-system
adb root
adb remount

// 把模拟器上的文件pull到本地
adb pull /etc/hosts newHosts

// 添加 &quot;10.0.2.2    your_domain&quot;
vi newHosts             

adb push newHosts /etc/hosts

// 进入模拟器的shell
adb shell
</code></pre>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article id="post-Reactive-Scala-Driver-for-MongoDB" class="h-entry post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time class="dt-published" datetime="2016-11-13T07:22:50.000Z"><a href="/2016/11/13/Reactive-Scala-Driver-for-MongoDB/">2016-11-13</a></time>
      
      
  
    <h1 class="title"><a href="/2016/11/13/Reactive-Scala-Driver-for-MongoDB/">Reactive Scala Driver for MongoDB</a></h1>
  

    </header>
    <div class="e-content entry" itemprop="articleBody">
      
        <p>其实最好的学习文档就是官方提供的<a target="_blank" rel="noopener" href="http://reactivemongo.org/releases/0.12/documentation/index.html">http://reactivemongo.org/releases/0.12/documentation/index.html</a>。</p>
<p><strong><a target="_blank" rel="noopener" href="http://reactivemongo.org/releases/0.12/documentation/tutorial/connect-database.html">关于Driver和Connection</a></strong></p>
<p>MongoDriver的实例管理者共享的资源，比如用于异步处理的actor system。<br>一个连接管理着网络连接池。通常一个driver和connection在一个应用中只需要一个实例即可。</p>
<p>MongoConnection是一个逻辑连接的表示，实际是有一个连接池构成，默认有10个连接。可以通过connection option参数rm.nbChannelsPerNode进行设置。<br>Driver和connection的创建是有代价的，所以在应用中可以创建之后共享使用。而DefaultDB， Collection这样的对象是及其轻量的，随用随建即可。而且我们也不应创建出DB，Collection之后把这些引用就保存起来一直使用，因为如果底层网络出现问题，你一直使用的这个DB活着Collection对象就会出现问题。随用随取这种方式可以避免获得有问题的对象。</p>
<p><strong>Connection options</strong></p>
<pre><code>import reactivemongo.api.MongoConnectionOptions

val conOpts = MongoConnectionOptions(/* connection options */)
val connection4 = driver1.connection(List(&quot;localhost&quot;), options = conOpts)
</code></pre>
<p>通过设置连接选项参数可以指定网络连接、mongo写关注等方面的行为。<br>详情参见</p>
<p><a target="_blank" rel="noopener" href="https://docs.mongodb.com/manual/reference/write-concern/">Write-concern文档</a><br><a target="_blank" rel="noopener" href="http://reactivemongo.org/releases/0.12/documentation/advanced-topics/read-preferences.html">Read-preferences文档</a></p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article id="post-使用Maven-pom的聚会、继承来组织项目" class="h-entry post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time class="dt-published" datetime="2016-09-28T16:05:26.000Z"><a href="/2016/09/29/%E4%BD%BF%E7%94%A8Maven-pom%E7%9A%84%E8%81%9A%E4%BC%9A%E3%80%81%E7%BB%A7%E6%89%BF%E6%9D%A5%E7%BB%84%E7%BB%87%E9%A1%B9%E7%9B%AE/">2016-09-29</a></time>
      
      
  
    <h1 class="title"><a href="/2016/09/29/%E4%BD%BF%E7%94%A8Maven-pom%E7%9A%84%E8%81%9A%E4%BC%9A%E3%80%81%E7%BB%A7%E6%89%BF%E6%9D%A5%E7%BB%84%E7%BB%87%E9%A1%B9%E7%9B%AE/">使用Maven pom的聚和、继承来组织项目</a></h1>
  

    </header>
    <div class="e-content entry" itemprop="articleBody">
      
        
      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article id="post-在遗留项目中使用-Spring-Boot-and-Cloud" class="h-entry post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time class="dt-published" datetime="2016-09-19T14:34:40.000Z"><a href="/2016/09/20/%E5%9C%A8%E9%81%97%E7%95%99%E9%A1%B9%E7%9B%AE%E4%B8%AD%E4%BD%BF%E7%94%A8-Spring-Boot-and-Cloud/">2016-09-20</a></time>
      
      
  
    <h1 class="title"><a href="/2016/09/20/%E5%9C%A8%E9%81%97%E7%95%99%E9%A1%B9%E7%9B%AE%E4%B8%AD%E4%BD%BF%E7%94%A8-Spring-Boot-and-Cloud/">在遗留项目中使用 Spring Boot and Cloud</a></h1>
  

    </header>
    <div class="e-content entry" itemprop="articleBody">
      
        <p>几年前还没有Spring Booot的时候，公司Maven项目里一般都定义了自己的parent pom，规范了可用的第三方类库。在这样的系统里如何引进Spring Boot，Spring Clould这样的工具呢？这篇<a target="_blank" rel="noopener" href="http://docs.spring.io/spring-boot/docs/current/reference/html/using-boot-build-systems.html">官方文档</a>介绍了在已有parent pom的情况下如何使用boot。</p>
<p>下面算是几个学习摘要。</p>
<p><strong>1) 如果遗留项目中没有使用自己parent pom，那么在项目模块中就可以直接设置parent为spring-boot-starter-parent</strong></p>
<pre><code>&lt;!-- Inherit defaults from Spring Boot --&gt;
&lt;parent&gt;
    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
    &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;
    &lt;version&gt;1.3.6.RELEASE&lt;/version&gt;
&lt;/parent&gt;
</code></pre>
<p>如果想更改某个子项目版本，通过下面设置属性的方式进行更改。</p>
<pre><code>&lt;properties&gt;
    &lt;spring-data-releasetrain.version&gt;Fowler-SR2&lt;/spring-data-releasetrain.version&gt;
&lt;/properties&gt;
</code></pre>
<p>查看有哪些可更改的properties，<a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/blob/v1.3.6.RELEASE/spring-boot-dependencies/pom.xml">参考这里</a>。</p>
<p><strong>2）如果已有的maven项目中已经存在parent pom，那么可以通过 denpendencyManagemengt的方式指定boot的BOM。</strong></p>
<pre><code>&lt;dependencyManagement&gt;
     &lt;dependencies&gt;
        &lt;dependency&gt;
            &lt;!-- Import dependency management from Spring Boot --&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-dependencies&lt;/artifactId&gt;
            &lt;version&gt;1.3.6.RELEASE&lt;/version&gt;
            &lt;type&gt;pom&lt;/type&gt;
            &lt;scope&gt;import&lt;/scope&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;
&lt;/dependencyManagement&gt;
</code></pre>
<p>这种情况下，如果需要指定某个版本的库，就需要在定义spring-boot-dependencies的前面定义dependence了。就像下面这样，spring-data-releasetrain使用了不同于1.3.6.RELEASE的另一个版本Fowler-SR2。</p>
<pre><code>&lt;dependencyManagement&gt;
    &lt;dependencies&gt;
        &lt;!-- Override Spring Data release train provided by Spring Boot --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.data&lt;/groupId&gt;
            &lt;artifactId&gt;spring-data-releasetrain&lt;/artifactId&gt;
            &lt;version&gt;Fowler-SR2&lt;/version&gt;
            &lt;scope&gt;import&lt;/scope&gt;
            &lt;type&gt;pom&lt;/type&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-dependencies&lt;/artifactId&gt;
            &lt;version&gt;1.3.6.RELEASE&lt;/version&gt;
            &lt;type&gt;pom&lt;/type&gt;
            &lt;scope&gt;import&lt;/scope&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;
&lt;/dependencyManagement&gt;
</code></pre>
<p><strong>3）关于Maven中BOM[Bill Of Materials]的概念。</strong><br>这篇文章讲得不错：<a target="_blank" rel="noopener" href="http://howtodoinjava.com/maven/maven-bom-bill-of-materials-dependency/">http://howtodoinjava.com/maven/maven-bom-bill-of-materials-dependency/</a>。</p>
<blockquote>
<p>A BOM dependency keep track of version numbers and ensure that all dependencies (both direct and transitive) are at the same version.</p>
</blockquote>
<p><strong>4) 如何添加BOM依赖?</strong></p>
<p>maven通过dependencyManagement来支持BOM。比如像下面这样加入Spring BOM。</p>
<pre><code>&lt;dependencyManagement&gt;
    &lt;dependencies&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework&lt;/groupId&gt;
            &lt;artifactId&gt;spring-framework-bom&lt;/artifactId&gt;
            &lt;version&gt;4.0.1.RELEASE&lt;/version&gt;
            &lt;type&gt;pom&lt;/type&gt;
            &lt;scope&gt;import&lt;/scope&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;
&lt;/dependencyManagement&gt;
</code></pre>
<p>那么，以后再使用那个这个BOM包含的库时，就不必制定version了。比如：</p>
<pre><code>&lt;dependencies&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.springframework&lt;/groupId&gt;
        &lt;artifactId&gt;spring-context&lt;/artifactId&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.springframework&lt;/groupId&gt;
        &lt;artifactId&gt;spring-web&lt;/artifactId&gt;
    &lt;/dependency&gt;
&lt;dependencies&gt;
</code></pre>
<p>在__dependencyManagement下的声明不会引入实际的依赖__，它仅仅__用来约束dependencies__下面的依赖使用。<br>虽然这个BOM概念很赞，但是不要幻想有什么通用的BOM。每个项目都有它自己的BOM文件用来管理用到的库依赖。</p>
<p><strong>5) 图例</strong></p>
<p>下图用来说明一下从start.spring.io网站，生产的模版项目中，pom.xml对SpringBoot，SpringCloud作为BOM的使用。一般地，我们应该把这这些BOM定义在作为parent使用的pom里进行集中地、统一地管理。<br><img src="/2016/09/19/%E5%9C%A8%E9%81%97%E7%95%99%E9%A1%B9%E7%9B%AE%E4%B8%AD%E4%BD%BF%E7%94%A8-Spring-Boot-and-Cloud/SpringBootCloud_pomSmaple.png" alt="一个pom的例子"></p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article id="post-network/tcp_close-wait_time-wait" class="h-entry post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time class="dt-published" datetime="2016-09-19T07:55:38.000Z"><a href="/2016/09/19/network/tcp_close-wait_time-wait/">2016-09-19</a></time>
      
      
  
    <h1 class="title"><a href="/2016/09/19/network/tcp_close-wait_time-wait/">关于TCP的好文章</a></h1>
  

    </header>
    <div class="e-content entry" itemprop="articleBody">
      
        <h4 id="关于挥手中的-close-wait-time-wait。"><a href="#关于挥手中的-close-wait-time-wait。" class="headerlink" title="关于挥手中的 close-wait, time-wait。"></a>关于挥手中的 close-wait, time-wait。</h4><ul>
<li><p><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s?__biz=MzI4MjA4ODU0Ng==&mid=402163560&idx=1&sn=5269044286ce1d142cca1b5fed3efab1&3rd=MzA3MDU4NTYzMw==&scene=6#rd">又见 CLOSE_WAIT</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://juejin.cn/post/6844903734300901390">线上大量 CLOSE_WAIT 的原因深入分析</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/kevingrace/p/9988354.html">TCP 连接的 TIME_WAIT 和 CLOSE_WAIT 状态解说</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/Jt2ss3SsE_iGJp5oW8QDSw">高性能网络 | 你所不知道的 TIME_WAIT 和 CLOSE_WAIT</a></p>
</li>
</ul>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>





<nav id="pagination">
  
    <a href="/page/7/" class="alignleft prev">上一页</a>
  
  
    <a href="/page/9/" class="alignright next">下一页</a>
  
  <div class="clearfix"></div>
</nav></div></div>
    <aside id="sidebar" class="alignright">
  <div class="search">
  <form action="//google.com/search" method="get" accept-charset="utf-8">
    <input type="search" name="q" results="0" placeholder="搜索">
    <input type="hidden" name="as_sitesearch" value="dhyuan.github.io">
  </form>
</div>


  

  
<div class="widget tag">
  <h3 class="title">标签</h3>
  <ul class="entry">
  
    <li><a href="/tags/AWS/">AWS</a><small>2</small></li>
  
    <li><a href="/tags/CAS/">CAS</a><small>5</small></li>
  
    <li><a href="/tags/Concurrency/">Concurrency</a><small>6</small></li>
  
    <li><a href="/tags/DevOps/">DevOps</a><small>31</small></li>
  
    <li><a href="/tags/FP/">FP</a><small>2</small></li>
  
    <li><a href="/tags/Git/">Git</a><small>1</small></li>
  
    <li><a href="/tags/Ingerss/">Ingerss</a><small>1</small></li>
  
    <li><a href="/tags/Java/">Java</a><small>10</small></li>
  
    <li><a href="/tags/Kubernetes/">Kubernetes</a><small>3</small></li>
  
    <li><a href="/tags/Maven/">Maven</a><small>2</small></li>
  
    <li><a href="/tags/MicroService/">MicroService</a><small>3</small></li>
  
    <li><a href="/tags/MongoDB/">MongoDB</a><small>6</small></li>
  
    <li><a href="/tags/Nginx/">Nginx</a><small>2</small></li>
  
    <li><a href="/tags/Reactive/">Reactive</a><small>8</small></li>
  
    <li><a href="/tags/SAGA/">SAGA</a><small>1</small></li>
  
    <li><a href="/tags/Scala/">Scala</a><small>7</small></li>
  
    <li><a href="/tags/Security/">Security</a><small>12</small></li>
  
    <li><a href="/tags/Spring/">Spring</a><small>14</small></li>
  
    <li><a href="/tags/android/">android</a><small>1</small></li>
  
    <li><a href="/tags/network/">network</a><small>2</small></li>
  
    <li><a href="/tags/%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95/">性能测试</a><small>1</small></li>
  
    <li><a href="/tags/%E7%AC%94%E8%AE%B0/">笔记</a><small>13</small></li>
  
    <li><a href="/tags/%E7%BD%91%E4%B8%8A%E5%A5%BD%E6%96%87/">网上好文</a><small>1</small></li>
  
  </ul>
</div>


  
  <div class="widget widget-archives">
    <h3 class="title">归档</h3>
    <div class="entry">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/06/">六月 2024</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/05/">五月 2023</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/02/">二月 2023</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/11/">十一月 2022</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/09/">九月 2022</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/08/">八月 2022</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/05/">五月 2022</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/10/">十月 2021</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/07/">七月 2021</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/05/">五月 2021</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/04/">四月 2021</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/03/">三月 2021</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/02/">二月 2021</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/12/">十二月 2020</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/11/">十一月 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/10/">十月 2020</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/09/">九月 2020</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/05/">五月 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/04/">四月 2020</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">三月 2020</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/02/">二月 2020</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">十月 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/09/">九月 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">九月 2018</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">八月 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/11/">十一月 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/09/">九月 2016</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/08/">八月 2016</a><span class="archive-list-count">1</span></li></ul>
    </div>
  </div>


</aside>
    <div class="clearfix"></div>
  </div>
  <footer id="footer" class="inner"><div class="alignleft">
  
  &copy; 2025 Dahui
  
</div>
<div class="clearfix"></div></footer>
  
<script src="/js/jquery-3.4.1.min.js"></script>


<script src="/js/jquery.imagesloaded.min.js"></script>


<script src="/js/gallery.js"></script>






<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">


<script src="/fancybox/jquery.fancybox.pack.js"></script>

<script>
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>

</body>
</html>
